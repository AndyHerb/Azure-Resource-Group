{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",

  "parameters": {
    "globals": {
      "metadata": {
        "Description": "Global complex object passed to nested templates"
      },
      "type": "object"
    }
  },

  "variables": {
    "azureDnsZone": "[concat('.', resourceGroup().location, '.cloudapp.azure.com')]",

    "pipVpnRdgName": "[concat('pip', parameters('globals').baseName, '-rdg01')]",
    "pipVpnRdgDns": "[toLower(concat(variables('pipVpnRdgName'),'-vpn'))]",

    "pipVpnFtpName": "[concat('pip', parameters('globals').baseName, '-ftp01')]",
    "pipVpnFtpDns": "[toLower(variables('pipVpnFtpName'))]",

    "pipDevSqlName": "[concat('pip', parameters('globals').baseName, '-d-sql01')]",
    "pipDevSqlDns": "[toLower(variables('pipDevSqlName'))]",

    "pipUatSqlName": "[concat('pip', parameters('globals').baseName, '-u-sql01')]",
    "pipUatSqlDns": "[toLower(variables('pipUatSqlName'))]",

    "pipPrdSqlName": "[concat('pip', parameters('globals').baseName, '-p-prd01')]",
    "pipPrdSqlDns": "[toLower(variables('pipPrdSqlName'))]",

    "pipDevIisName": "[concat('pip', parameters('globals').baseName, '-d-iis01')]",
    "pipDevIisDns": "[toLower(variables('pipDevIisName'))]",

    "pipUatIisName": "[concat('pip', parameters('globals').baseName, '-u-iis01')]",
    "pipUatIisDns": "[toLower(variables('pipUatIisName'))]",

    "pipPrdIisName": "[concat('pip', parameters('globals').baseName, '-p-iis01')]",
    "pipPrdIisDns": "[toLower(variables('pipPrdIisName'))]"
  },

  "resources": [
    {
        "name": "[concat(variables('pipVpnRdgName'),'-vpn')]",
        "type": "Microsoft.Network/publicIPAddresses",
        "apiVersion": "[parameters('globals').apiVersion.pip]",
        "location": "[resourceGroup().location]",
        "properties": {
            "dnsSettings": {
                "domainNameLabel": "[variables('pipVpnRdgDns')]",
                "fqdn": "[concat(variables('pipVpnRdgDns'), '.', parameters('globals').childDnsZoneName)]"
            },
            "idleTimeoutInMinutes": 30,
            "publicIPAllocationMethod": "Static"
        }
    },
    {
        "name": "[concat(parameters('globals').childDnsZoneName, '/', variables('pipVpnRdgDns'))]",
        "type": "Microsoft.Network/dnsZones/A",
        "apiVersion": "[parameters('globals').apiVersion.dnsZone]",
        "properties": {
            "ARecords": [
                {
                    "ipv4Address": "[reference(resourceId('Microsoft.Network/publicIPAddresses', concat(variables('pipVpnRdgName'),'-vpn'))).IpAddress]"
                }
            ]
        }
    },
    {
        "name": "[variables('pipVpnFtpName')]",
        "type": "Microsoft.Network/publicIPAddresses",
        "apiVersion": "[parameters('globals').apiVersion.pip]",
        "location": "[resourceGroup().location]",
        "properties": {
            "dnsSettings": {
                "domainNameLabel": "[variables('pipVpnFtpDns')]",
                "fqdn": "[concat(variables('pipVpnFtpDns'), '.', parameters('globals').childDnsZoneName)]"
            },
            "idleTimeoutInMinutes": 30,
            "publicIPAllocationMethod": "Static"
        }
    },
    {
        "name": "[concat(parameters('globals').childDnsZoneName, '/', variables('pipVpnFtpName'))]",
        "type": "Microsoft.Network/dnsZones/A",
        "apiVersion": "[parameters('globals').apiVersion.dnsZone]",
        "properties": {
            "ARecords": [
                {
                    "ipv4Address": "[reference(resourceId('Microsoft.Network/publicIPAddresses', variables('pipVpnFtpName'))).IpAddress]"
                }
            ]
        }
    },
    {
        "name": "[variables('pipDevSqlName')]",
        "type": "Microsoft.Network/publicIPAddresses",
        "apiVersion": "[parameters('globals').apiVersion.pip]",
        "location": "[resourceGroup().location]",
        "properties": {
            "dnsSettings": {
                "domainNameLabel": "[variables('pipDevSqlDns')]",
                "fqdn": "[concat(variables('pipDevSqlDns'), '.', parameters('globals').childDnsZoneName)]"

            },
            "idleTimeoutInMinutes": 30,
            "publicIPAllocationMethod": "Static"
        }
    },
    {
        "name": "[concat(parameters('globals').childDnsZoneName, '/', variables('pipDevSqlName'))]",
        "type": "Microsoft.Network/dnsZones/A",
        "apiVersion": "[parameters('globals').apiVersion.dnsZone]",
        "properties": {
            "ARecords": [
                {
                    "ipv4Address": "[reference(resourceId('Microsoft.Network/publicIPAddresses', variables('pipDevSqlName'))).IpAddress]"
                }
            ]
        }
    },
    {
        "name": "[variables('pipUatSqlName')]",
        "type": "Microsoft.Network/publicIPAddresses",
        "apiVersion": "[parameters('globals').apiVersion.pip]",
        "location": "[resourceGroup().location]",
        "properties": {
            "dnsSettings": {
                "domainNameLabel": "[variables('pipUatSqlDns')]",
                "fqdn": "[concat(variables('pipUatSqlDns'), '.', parameters('globals').childDnsZoneName)]"
            },
            "idleTimeoutInMinutes": 30,
            "publicIPAllocationMethod": "Static"
        }
    },
    {
        "name": "[concat(parameters('globals').childDnsZoneName, '/', variables('pipUatSqlName'))]",
        "type": "Microsoft.Network/dnsZones/A",
        "apiVersion": "[parameters('globals').apiVersion.dnsZone]",
        "properties": {
            "ARecords": [
                {
                    "ipv4Address": "[reference(resourceId('Microsoft.Network/publicIPAddresses', variables('pipUatSqlName'))).IpAddress]"
                }
            ]
        }
    },
    {
        "name": "[variables('pipPrdSqlName')]",
        "type": "Microsoft.Network/publicIPAddresses",
        "apiVersion": "[parameters('globals').apiVersion.pip]",
        "location": "[resourceGroup().location]",
        "properties": {
            "dnsSettings": {
                "domainNameLabel": "[variables('pipPrdSqlDns')]",
                "fqdn": "[concat(variables('pipPrdSqlDns'), '.', parameters('globals').childDnsZoneName)]"
            },
            "idleTimeoutInMinutes": 30,
            "publicIPAllocationMethod": "Static"
        }
    },
    {
        "name": "[concat(parameters('globals').childDnsZoneName, '/', variables('pipPrdSqlName'))]",
        "type": "Microsoft.Network/dnsZones/A",
        "apiVersion": "[parameters('globals').apiVersion.dnsZone]",
        "properties": {
            "ARecords": [
                {
                    "ipv4Address": "[reference(resourceId('Microsoft.Network/publicIPAddresses', variables('pipPrdSqlName'))).IpAddress]"
                }
            ]
        }
    },
    {
        "name": "[variables('pipDevIisName')]",
        "type": "Microsoft.Network/publicIPAddresses",
        "apiVersion": "[parameters('globals').apiVersion.pip]",
        "location": "[resourceGroup().location]",
        "properties": {
            "dnsSettings": {
                "domainNameLabel": "[variables('pipDevIisDns')]",
                "fqdn": "[concat(variables('pipDevIisDns'), '.', parameters('globals').childDnsZoneName)]"
            },
            "idleTimeoutInMinutes": 30,
            "publicIPAllocationMethod": "Static"
        }
    },
    {
        "name": "[concat(parameters('globals').childDnsZoneName, '/', variables('pipDevIisName'))]",
        "type": "Microsoft.Network/dnsZones/A",
        "apiVersion": "[parameters('globals').apiVersion.dnsZone]",
        "properties": {
            "ARecords": [
                {
                    "ipv4Address": "[reference(resourceId('Microsoft.Network/publicIPAddresses', variables('pipDevIisName'))).IpAddress]"
                }
            ]
        }
    },
    {
        "name": "[variables('pipUatIisName')]",
        "type": "Microsoft.Network/publicIPAddresses",
        "apiVersion": "[parameters('globals').apiVersion.pip]",
        "location": "[resourceGroup().location]",
        "properties": {
            "dnsSettings": {
                "domainNameLabel": "[variables('pipUatIisDns')]",
                "fqdn": "[concat(variables('pipUatIisDns'), '.', parameters('globals').childDnsZoneName)]"
            },
            "idleTimeoutInMinutes": 30,
            "publicIPAllocationMethod": "Static"
        }
    },
    {
        "name": "[concat(parameters('globals').childDnsZoneName, '/', variables('pipUatIisName'))]",
        "type": "Microsoft.Network/dnsZones/A",
        "apiVersion": "[parameters('globals').apiVersion.dnsZone]",
        "properties": {
            "ARecords": [
                {
                    "ipv4Address": "[reference(resourceId('Microsoft.Network/publicIPAddresses', variables('pipUatIisName'))).IpAddress]"
                }
            ]
        }
    },
    {
        "name": "[variables('pipPrdIisName')]",
        "type": "Microsoft.Network/publicIPAddresses",
        "apiVersion": "[parameters('globals').apiVersion.pip]",
        "location": "[resourceGroup().location]",
        "properties": {
            "dnsSettings": {
                "domainNameLabel": "[variables('pipPrdIisDns')]",
                "fqdn": "[concat(variables('pipPrdIisDns'), '.', parameters('globals').childDnsZoneName)]"
            },
            "idleTimeoutInMinutes": 30,
            "publicIPAllocationMethod": "Static"
        }
    },
    {
        "name": "[concat(parameters('globals').childDnsZoneName, '/', variables('pipPrdIisName'))]",
        "type": "Microsoft.Network/dnsZones/A",
        "apiVersion": "[parameters('globals').apiVersion.dnsZone]",
        "properties": {
            "ARecords": [
                {
                    "ipv4Address": "[reference(resourceId('Microsoft.Network/publicIPAddresses', variables('pipPrdIisName'))).IpAddress]"
                }
            ]
        }
    }
  ]
}
